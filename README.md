
# Анализ динамики котировок Сургутнефтегаза

Данные, на основе которых выполнен проект получены с помощью парсинга сайта MOEX, где выбрана страница "итоги торгов". Полученный парсинг покрывает котировки акций Сургутнефтегаза, Сбербанка, а также цены фьючерсов на нефть марки Brent и на доллар Si в период с 2015 по 2023 год.

Идеи и цели нашего проекта:
1) Собрать данные, проверить, насколько признаки (нефть, валюта, Сбер, Сургутнефтегаз) зависимы друг от друга. Создать производные таблицы для удобства дальшейшего использования.
2) Проверить связь налогового периода и курса доллара, чтобы понять, насколько день месяца имеет влияние на признак, имеющий сильную положительную корреляцию с таргетом - ценой Сургутнефтегаза.
3) Создать прогноз цены Сургутнефтегаза на основе таких признаков, как Br, Si, Sber с помощью машинного обучения.
4) Проанализировать адекватность прогнозной цены.
5) Исследовать аномальные значения в котировках Сургутнефтегаза с помощью машинного обучения.
6) Проверить гипотезы, которые дают большее понимание о том, насколько интересно инвестировать в Сургутнефтегаз.


## Файлы в репозитории

 - [Парсинг данных с сайта Московской Биржи](https://github.com/sungfala/Project_Python/blob/main/Шаг%201.%20Парсинг.ipynb)
 - [Анализ полученных данных](https://github.com/sungfala/Project_Python/blob/main/Анализ%20полученных%20данных.ipynb)
 - [Проверка гипотезы о налоговом периоде](https://github.com/sungfala/Project_Python/blob/main/Шаг%203.%20Гипотеза%20о%20налоговом%20периоде.ipynb)
 - [Линейная регрессия](https://github.com/sungfala/Project_Python/blob/main/Шаг%204.%20Линейная%20регрессия.ipynb)
 - [Поиск аномалий](https://github.com/sungfala/Project_Python/blob/main/Шаг%205.%20Поиск%20аномалий.ipynb)
 - [Гипотезы о матожидании и доходных днях](https://github.com/sungfala/Project_Python/blob/main/Шаг%206.%20Гипотезы%20о%20матожидании%20и%20доходных%20днях.ipynb)


## Шаг 1. Парсинг

На данном этапе мы с помощью Силениума спарсили 4 признака: фьючерс на нефть Брент, фьючерс на доллар, Сбер и Сургутнефтегаз. Всего в цикле получилось 102 странице данных, которые нужно вставить в конечную таблицу из 2021 строки по каждому признаку.

Ссылки на источники данных:
1) SNGS: https://www.moex.com/ru/marketdata/#/mode=instrument&secid=SNGS&boardgroupid=57&mode_type=history&date_from=2022-10-01&date_till=2023-05-01
2) SBER: https://www.moex.com/ru/marketdata/#/mode=instrument&secid=SBER&boardgroupid=57&mode_type=history&date_from=2022-10-01&date_till=2023-05-01
3) Si: https://www.moex.com/ru/forts/contractbaseresults.aspx?base=Si
4) Br: https://www.moex.com/ru/forts/contractbaseresults.aspx?base=OG

Далее в файле парсинга исправлялись ошибки, связанные с непрочтением запятых, а также данные приводились к виду, из которого уже можно строить анализ.
 
 
 ## Шаг 2. Анализ полученных данных
 
 Из данных 1 шага нужно получить несколько таблиц:
 
 
 
 
 ## Шаг 3. Гипотеза о налоговом периоде
 
На этом шаге мы создали несколько категориальных признаков: налоговый период, динамика роста. Налоговый период принимался за 1, если число, в которое шли торги, входило в промежуток с 22 по 28. 

Н0: курс рубля и доллара не связаны

Н1: если начинается налоговый период, рубль укрепляется

Далее посмотрели, имеет ли влияние налоговый период на котировки доллара, который уже непосредственно напрямую коррелирует с котировками Сургутнефтегаза. Корреляция есть, потому что это компания-экспортер и компания-держатель огромной валютной кубышки. Спойлер: то, что влияния нет, мы доказали с помощью хи-квадрат критерия, доли правильных ответов и фундаментального анализа. Пришли к выводу, что в дальнейшем исследовании таргет цены Сургута критерий "налоговый период" не поможет.
 

## Шаг 4. Линейная регрессия

Изначально наша идея заключалась в том, чтобы собрать консенсус-прогнозные значения признаков, которые дают ведущие инвест-дома и банки, и вставить их в модель, которая по ним предскажет таргет цену Сургутнефтегаза на 2024 год. Этой стратегии мы и придерживались.

Средневзвешенные прогнозные цены на 2024 год:

1) Нефть Brent - 87
2) Фьючерс на доллар Si - 60 000
3) SBER - 210

С помощью данной стратегии мы получили прогнозную цену, а потом оптимизировали модель линейной регрессии (подбирая параметры), чтобы улучшать метрики, по которым модель оценивается.

Test MAPE = 0.0954 \n
Train MAPE = 0.0883
Test RMSE = 5.2514
Train RMSE = 4.7846

Спойлер: средняя прогнозная цена Сургутнефтегаза на 2024 год составит 27 рублей с копейками ;)


## Шаг 5. Поиск аномалий







## Authors

- Головинская Анастасия (tg: @stasygol)
- Киосе Анна (tg: @akiose)
- Охотин Даниил (tg: @danokil)

